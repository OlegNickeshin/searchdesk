{% extends "layout.html" %}
{% block content %}

    <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 class="mb-0">Rules</h3>

        <button class="btn btn-outline-dark"
                data-bs-toggle="modal"
                data-bs-target="#addRuleModal">
            Add rule
        </button>
    </div>

    <section class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Query</th>
                    <th class="text-center">In-stock first</th>
                    <th>Brand boost</th>
                    <th>Gender boost</th>
                    <th>Category boost</th>
                    <th>Created</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for r in rules %}
                    <tr>
                        <td>{{ r["name"] }}</td>
                        <td><code>{{ r["query_text"] }}</code></td>
                        <td class="text-center">
                            {% if r["in_stock_first"] %}✅{% else %}—{% endif %}
                        </td>
                        <td class="text-muted">{{ r["brand_boost"] or "—" }}</td>
                        <td class="text-muted">{{ r["gender_boost"] or "—" }}</td>
                        <td class="text-muted">{{ r["category_boost"] or "—" }}</td>
                        <td class="text-muted">{{ r["created_at"] }}</td>
                        <td class="text-end">
                            <form action="/rules/{{ r['id'] }}/delete"
                                  method="post"
                                  class="d-inline">
                                <button class="btn btn-sm btn-outline-danger"
                                        onclick="return confirm('Delete this rule?')">
                                    Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="8"
                            class="text-center text-muted py-4">
                            No rules yet. Add your first rule.
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <!-- Add Rule Modal -->
    <div class="modal fade"
         id="addRuleModal"
         tabindex="-1"
         aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">

                <form action="/rules/new" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title">Add rule</h5>
                        <button type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Close">
                        </button>
                    </div>

                    <div class="modal-body">
                        <div class="row g-3">

                            <div class="col-12">
                                <label class="form-label">Name</label>
                                <input class="form-control"
                                       name="name"
                                       required
                                       placeholder="Boost Nike for 'nike shoes'">
                            </div>

                            <div class="col-12">
                                <label class="form-label">
                                    Query text
                                </label>
                                <input class="form-control"
                                       name="query_text"
                                       required
                                       placeholder="nike shoes">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Match type</label>
                                <select name="match_type" class="form-select">
                                    <option value="exact" selected>exact</option>
                                    <option value="contains">contains</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Brand boost</label>
                                <input class="form-control"
                                       name="brand_boost"
                                       placeholder="Nike:50,Adidas:20">
                                <div class="form-text">
                                    Format: Brand:Boost,Brand:Boost
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Gender boost</label>
                                <input class="form-control"
                                       name="gender_boost"
                                       placeholder="man:30,woman:10,unisex:5">
                                <div class="form-text">
                                    Format: man:Boost,woman:Boost,unisex:Boost
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Category boost</label>
                                <input class="form-control"
                                       name="category_boost"
                                       placeholder="Running:20">
                                <div class="form-text">
                                    Format: Category:Boost,Category:Boost
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           value="1"
                                           id="inStockFirst"
                                           name="in_stock_first">
                                    <label class="form-check-label"
                                           for="inStockFirst">
                                        In-stock first
                                    </label>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button"
                                class="btn btn-outline-secondary"
                                data-bs-dismiss="modal">
                            Cancel
                        </button>
                        <button type="submit"
                                class="btn btn-dark">
                            Create
                        </button>
                    </div>

                </form>

            </div>
        </div>
    </div>

{% endblock %}
